# Lockpass ‚Üí Passbolt Converter

This Python script converts a CSV file exported from Lockpass to a CSV format compatible with Passbolt (LastPass format).

## üìã Prerequisites

- Python 3.6 or higher
- A CSV file exported and decrypted from Lockpass

## üöÄ Installation

No external library installation required. The script uses only Python standard modules.

**The script automatically detects file encoding** and supports:
- UTF-8 (with or without BOM)
- UTF-16 (LE/BE)
- Latin-1
- Windows-1252
- ISO-8859-1

**The output file is always UTF-8 with BOM** for maximum compatibility with Excel and Passbolt.

## üíª Usage

### Main Features

The script:
- ‚úÖ Automatically detects source file encoding
- ‚úÖ Converts all fields (URL, username, password, name, etc.)
- ‚úÖ Preserves categories/subcategories and TOTP codes
- ‚úÖ Combines Description, Opt1-3, and Tags into the "extra" field
- ‚úÖ **Automatically filters invalid entries** (without URL or password)
- ‚úÖ Generates a report of ignored entries in a `_ignores.txt` file
- ‚úÖ Displays a preview of successful conversions

### Basic Syntax

```bash
python lockpass_to_passbolt.py <lockpass_file.csv> [output_file.csv]
```

### Examples

1. **Simple conversion** (output file will be created automatically):
   ```bash
   python lockpass_to_passbolt.py lockpass_export.csv
   ```
   This will create a file named `lockpass_export_passbolt.csv`

2. **Conversion with custom filename**:
   ```bash
   python lockpass_to_passbolt.py lockpass_export.csv my_passbolt_import.csv
   ```

## üìä Data Format

### Lockpass (Input)
The script expects a CSV with the following columns (separator `;`):
- Name
- Url
- Username
- Password
- Category/SubCategory
- Tags
- Description
- Opt1
- Opt2
- Opt3
- Totp
- Type

### Passbolt (Output)
The script generates a LastPass-compatible CSV with the following columns (separator `,`):
- url
- username
- password
- extra (contains Description, Opt1, Opt2, Opt3, and Tags)
- name
- grouping (corresponds to Category/SubCategory)
- fav (always 0 by default)
- totp

## üîÑ Field Mapping

| Lockpass | Passbolt | Note |
|----------|----------|------|
| Url | url | Direct copy |
| Username | username | Direct copy |
| Password | password | Direct copy |
| Name | name | Direct copy |
| Category/SubCategory | grouping | Direct copy |
| Totp | totp | Direct copy |
| Description | extra | Combined with Opt1-3 and Tags |
| Opt1 | extra | Added to extra field |
| Opt2 | extra | Added to extra field |
| Opt3 | extra | Added to extra field |
| Tags | extra | Added to extra field |
| - | fav | Always 0 (not favorite) |

## üì• Import into Passbolt

1. Open Passbolt
2. Click the Create button
3. Select **"Import resources"**
4. Select the CSV file generated by this script
5. Let the import process complete

## ‚ö†Ô∏è Important Notes

- The script preserves all Lockpass information in Passbolt's `extra` field
- Categories and subcategories are preserved in the `grouping` field
- By default, all passwords are marked as non-favorites (fav=0)
- TOTP codes are preserved
- **Entries without URL AND password are automatically ignored** because Passbolt cannot import them
- An `_ignores.txt` file is created to list ignored entries that you'll need to create manually

### Why are some entries ignored?

Passbolt requires at minimum:
- A URL **OR** a password

Entries that have neither cannot be imported. The script automatically filters them and informs you via:
1. A console message
2. A detailed `*_ignores.txt` report file

### URLs too long (>1024 characters)

Passbolt limits URLs to a maximum of 1024 characters. If your Lockpass file contains longer URLs (often complex login URLs with tokens):
- The complete URL is moved to the "extra" field
- The URL field remains empty
- Password and other information are preserved

### Invalid TOTP codes

TOTP codes must be in **base32** format (example: `JBSWY3DPEHPK3PXP`).
- If Lockpass contains invalid TOTP codes (like "0000", "123456", etc.), they are moved to the "extra" field
- Valid TOTP codes are preserved in the TOTP field
- You can manually configure TOTP in Passbolt if necessary

## üêõ Troubleshooting

### Error "Ko::buildOrCloneEntity expects data to be an object"
This error has been fixed. It was caused by entries without URL or password. The script now automatically filters these entries.

### Error "The uris.0 should be 1024 character in length maximum"
This error is now handled automatically. URLs that are too long are moved to the "extra" field.

### Error "The secret_key is not valid" (TOTP)
Invalid TOTP codes are now automatically detected and moved to the "extra" field. Only codes in valid base32 format are kept in the TOTP field.

### Message "Imported with default content type"
This is a warning from Passbolt, not an error. Your data has been imported successfully, but Passbolt couldn't automatically determine the resource type for some entries (e.g., no URL). These entries are still imported.

### Partially imported entries
If you see "Partially imported", check:
1. The `*_ignores.txt` file to see entries that couldn't be converted
2. These entries will need to be created manually in Passbolt

### Encoding error
The script automatically detects your file's encoding. If you still encounter problems:
1. Open your CSV file in a text editor (Notepad++, VS Code, etc.)
2. Re-save it in UTF-8
3. Retry the conversion

### Incorrect separator
The script expects a `;` separator for Lockpass. If your export uses a different separator, you'll need to modify the file or re-export from Lockpass.

### Passbolt import problems
If the import fails:
1. Verify that you selected "LastPass" as the import format
2. Ensure your Passbolt version supports LastPass import
3. Check Passbolt error logs for more details

## üìù Conversion Example

**Lockpass (input)**:
```
Name;Url;Username;Password;Category/SubCategory;Tags;Description;Opt1;Opt2;Opt3;Totp;Type
NAS Account;192.168.0.1;backup;azerty123*;"Company/NAS";nas backup;NAS backup password;671282;1282;;cmzkplfkmdm6qzff
```

**Passbolt (output)**:
```
"url","username","password","extra","name","grouping","fav","totp"
"192.168.0.1","backup","azerty123*","Description: NAS backup password | Opt1: 671282 | Opt2: 1282 | Tags: nas backup","NAS Account","Company/NAS","0","cmzkplfkmdm6qzff"
```

**Note**: The "extra" field uses " | " as a separator for better Passbolt compatibility.

## üìÑ License

Script created to facilitate migration from Lockpass to Passbolt.
